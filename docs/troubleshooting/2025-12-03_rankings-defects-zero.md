# Rankings Defects Per Year Shows 0.0000

Date: 2025-12-03
Status: In Progress

## Symptoms

- Top 10 rankings on the website show 0.0000 for all defects/year values
- Both brands and models affected

## Root Cause Analysis

Investigated the data pipeline to find where the issue originates:

1. Checked `data/processed/rankings.json` - found it contains `avg_defects_per_inspection` field instead of `defects_per_year`
2. Checked `data/processed/brand_stats.json` - correctly contains `defects_per_year` values (e.g., 0.027517)
3. The `ranking_entry_format()` function in `data_process.py` expects and outputs `defects_per_year`
4. The website `RankingEntry` TypeScript type expects `defects_per_year`

Conclusion: The `rankings.json` file in `data/processed/` was generated by an older version of the code that output `avg_defects_per_inspection`. The current code is correct, but the cached data was stale.

## First Fix Attempt (2025-12-03)

Re-ran Stage 2 (`data_process.py`) locally to regenerate `rankings.json` with the correct field names. Pushed changes. Pipeline ran successfully.

However, the live site still shows incorrect data because:

- GitHub Actions cache key `processed-data-v2-2025-W49` contains the old data
- Stage 3 restores from this stale cache instead of using the freshly generated artifact

## Second Fix (2025-12-04)

Need to bust the cache by changing the cache key version from `v2` to `v3` in:

- `.github/workflows/data_process.yml`
- `.github/workflows/website_build.yml`

## Verification

After cache bust:

1. Confirm `rankings.json` contains `defects_per_year` field (e.g., "defects_per_year": 0.01637)
2. Website build succeeds
3. Rankings show non-zero values on live site
