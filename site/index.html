<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dutch Car Reliability - RDW Analysis</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="sample-banner" class="sample-banner" style="display: none;"></div>
    
    <h1>Dutch Car Reliability Analysis</h1>
    <p class="subtitle">Based on APK (MOT) inspection data from RDW Open Data</p>
    <p class="summary-stats" id="summary-stats">Loading data...</p>
    
    <nav class="nav">
        <button class="nav-btn active" data-view="top10">Top 10 Lists</button>
        <button class="nav-btn" data-view="brands">Reliability by Brand</button>
        <button class="nav-btn" data-view="models">Reliability by Model</button>
        <button class="nav-btn" data-view="about">About the Data</button>
    </nav>
    
    <!-- Top 10 View -->
    <section id="view-top10" class="view-section active">
        <h2>Top 10 Most Reliable and Least Reliable Cars</h2>
        <div class="info-box card">
            <p><strong>How to read these lists:</strong> Lower defect numbers indicate more reliable vehicles.
            Rankings are based on average defects per inspection. Models with fewer than 50 vehicles are excluded.</p>
        </div>
        
        <div class="top10-container">
            <div class="card top10-card">
                <h3>Top 10 Most Reliable Models</h3>
                <table id="top10-reliable-table" class="top10-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Brand</th>
                            <th>Model</th>
                            <th>Defects/Insp.</th>
                            <th>Defects/Year</th>
                            <th>Avg Age</th>
                        </tr>
                    </thead>
                    <tbody id="top10-reliable-tbody"></tbody>
                </table>
            </div>
            
            <div class="card top10-card">
                <h3>Top 10 Least Reliable Models</h3>
                <table id="top10-unreliable-table" class="top10-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Brand</th>
                            <th>Model</th>
                            <th>Defects/Insp.</th>
                            <th>Defects/Year</th>
                            <th>Avg Age</th>
                        </tr>
                    </thead>
                    <tbody id="top10-unreliable-tbody"></tbody>
                </table>
            </div>
        </div>
        
        <div class="top10-container">
            <div class="card top10-card">
                <h3>Top 10 Most Reliable Brands</h3>
                <table id="top10-reliable-brands-table" class="top10-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Brand</th>
                            <th>Defects/Insp.</th>
                            <th>Defects/Year</th>
                            <th>Avg Age</th>
                        </tr>
                    </thead>
                    <tbody id="top10-reliable-brands-tbody"></tbody>
                </table>
            </div>
            
            <div class="card top10-card">
                <h3>Top 10 Least Reliable Brands</h3>
                <table id="top10-unreliable-brands-table" class="top10-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Brand</th>
                            <th>Defects/Insp.</th>
                            <th>Defects/Year</th>
                            <th>Avg Age</th>
                        </tr>
                    </thead>
                    <tbody id="top10-unreliable-brands-tbody"></tbody>
                </table>
            </div>
        </div>
    </section>
    
    <!-- Brand Reliability View -->
    <section id="view-brands" class="view-section">
        <h2>Reliability by Brand</h2>
        <div class="info-box card">
            <p><strong>How to read this table:</strong> Lower defect numbers indicate more reliable vehicles. 
            Click any column header to sort. Brands with fewer than 100 vehicles in our sample are excluded.</p>
        </div>
        <div class="card">
            <div class="filter-bar">
                <input type="text" id="brand-filter" placeholder="Filter brands...">
            </div>
            <div class="record-count" id="brand-count"></div>
            <table id="brand-table">
                <thead>
                    <tr>
                        <th data-col="merk" data-type="string">Brand<span class="sort-indicator"></span></th>
                        <th data-col="vehicle_count" data-type="number">Vehicles<span class="sort-indicator"></span></th>
                        <th data-col="total_inspections" data-type="number">Inspections<span class="sort-indicator"></span></th>
                        <th data-col="avg_defects_per_inspection" data-type="number">Defects per Inspection<span class="sort-indicator"></span></th>
                        <th data-col="defects_per_year" data-type="number">Defects per Year<span class="sort-indicator"></span></th>
                        <th data-col="avg_age_years" data-type="number">Avg Age<span class="sort-indicator"></span></th>
                    </tr>
                </thead>
                <tbody id="brand-tbody"></tbody>
            </table>
        </div>
    </section>
    
    <!-- Model Reliability View -->
    <section id="view-models" class="view-section">
        <h2>Reliability by Model</h2>
        <div class="info-box card">
            <p><strong>How to read this table:</strong> Lower defect numbers indicate more reliable vehicles. 
            Click any column header to sort. Models with fewer than 50 vehicles in our sample are excluded.</p>
        </div>
        <div class="card">
            <div class="filter-bar">
                <input type="text" id="model-filter" placeholder="Filter by brand or model...">
            </div>
            <div class="record-count" id="model-count"></div>
            <table id="model-table">
                <thead>
                    <tr>
                        <th data-col="merk" data-type="string">Brand<span class="sort-indicator"></span></th>
                        <th data-col="handelsbenaming" data-type="string">Model<span class="sort-indicator"></span></th>
                        <th data-col="vehicle_count" data-type="number">Vehicles<span class="sort-indicator"></span></th>
                        <th data-col="total_inspections" data-type="number">Inspections<span class="sort-indicator"></span></th>
                        <th data-col="avg_defects_per_inspection" data-type="number">Defects per Inspection<span class="sort-indicator"></span></th>
                        <th data-col="defects_per_year" data-type="number">Defects per Year<span class="sort-indicator"></span></th>
                        <th data-col="avg_age_years" data-type="number">Avg Age<span class="sort-indicator"></span></th>
                    </tr>
                </thead>
                <tbody id="model-tbody"></tbody>
            </table>
        </div>
    </section>
    
    <!-- About/Methodology View -->
    <section id="view-about" class="view-section">
        <h2>About the Data</h2>
        
        <div class="card">
            <h3>What is APK?</h3>
            <p>APK (Algemene Periodieke Keuring) is the mandatory vehicle safety inspection in the Netherlands, 
            similar to the MOT test in the UK or TUV in Germany. All vehicles must pass this inspection:</p>
            <ul>
                <li>First APK: when the car is 4 years old</li>
                <li>Then: every 2 years until the car is 8 years old</li>
                <li>After 8 years: annually</li>
            </ul>
            <p>During inspection, certified mechanics check brakes, lights, steering, emissions, and other safety-critical components.</p>
        </div>
        
        <div class="card">
            <h3>Understanding the Metrics</h3>
            
            <div class="metric-explanation">
                <h4>Defects per Inspection</h4>
                <p class="formula">= Total defect count / Number of inspections</p>
                <p>The average number of individual defects found each time a vehicle of this brand/model goes for APK inspection. 
                <strong>This is the primary reliability indicator.</strong></p>
                <p><em>Example: A value of 2.5 means on average, 2.5 individual defects are found per inspection visit.</em></p>
            </div>
            
            <div class="metric-explanation">
                <h4>Defects per Year (Age-Normalized)</h4>
                <p class="formula">= Defects per Inspection / Average Vehicle Age</p>
                <p>The defects per inspection normalized by the average age of vehicles. This accounts for the fact that older 
                vehicles naturally accumulate more defects. <strong>Lower values indicate better reliability when controlling for age.</strong></p>
                <p><em>Example: A 10-year-old car with 2.0 defects/inspection has 0.20 defects/year, while a 5-year-old car 
                with the same 2.0 defects/inspection has 0.40 defects/year - indicating the older car aged more gracefully.</em></p>
            </div>
            
            <div class="metric-explanation">
                <h4>Average Age</h4>
                <p class="formula">= Mean age of vehicles in years (from first registration date)</p>
                <p>The average age of vehicles in this brand/model group. Useful context for comparing reliability - 
                a brand with mostly newer cars might appear more reliable simply because the cars have had less time to develop issues.</p>
            </div>
            
            <div class="metric-explanation">
                <h4>Vehicles / Inspections</h4>
                <p>The sample size for each brand/model. More vehicles and inspections generally means more reliable statistics. 
                We require at least 100 vehicles for brands and 50 for models to be included.</p>
            </div>
        </div>
        
        <div class="card">
            <h3>Data Source</h3>
            <p>All data comes from <a href="https://opendata.rdw.nl/">RDW Open Data</a>, the official Dutch 
            vehicle registration authority. The data is updated daily and released under CC0 (public domain) license.</p>
            
            <p><strong>Datasets used:</strong></p>
            <ul>
                <li><a href="https://opendata.rdw.nl/Keuringen/Open-Data-RDW-Geconstateerde-Gebreken/a34c-vvps">Geconstateerde Gebreken</a> - Defects found during inspections</li>
                <li><a href="https://opendata.rdw.nl/Voertuigen/Open-Data-RDW-Gekentekende_voertuigen/m9d7-ebf2">Gekentekende Voertuigen</a> - Vehicle registration details</li>
            </ul>
        </div>
        
        <div class="card">
            <h3>Limitations</h3>
            <ul>
                <li><strong>Sample bias:</strong> Only includes vehicles that had defects recorded. Vehicles that passed 
                inspection with zero defects may not appear in the defects dataset.</li>
                <li><strong>Defect severity:</strong> All defects are counted equally, whether minor (e.g., license plate 
                light dim) or major (e.g., brake failure).</li>
                <li><strong>Maintenance history:</strong> Defects reflect both manufacturing quality and owner maintenance habits.</li>
            </ul>
        </div>
        
        <div class="card">
            <h3>Future Improvements</h3>
            <ul>
                <li>Defect severity weighting</li>
                <li>APK pass/fail rates (requires additional dataset)</li>
                <li>Common defect types by brand/model</li>
                <li>Year-over-year reliability trends</li>
            </ul>
        </div>
        
        <p class="updated">Data generated: <span id="generated-date">Loading...</span></p>
    </section>
    
    <footer>
        <p>Data source: <a href="https://opendata.rdw.nl/">RDW Open Data</a> (CC0 License)</p>
        <p>View source on <a href="https://github.com/">GitHub</a></p>
        <p class="last-updated">Last Updated: <span id="footer-date">Loading...</span></p>
    </footer>
    
    <script src="js/app.js"></script>
</body>
</html>
